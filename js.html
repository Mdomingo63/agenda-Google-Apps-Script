<script>

   const NOTIFICACION_OK = 1;
   const NOTIFICACION_DANGER = 2;
   const NOTIFICACION_WARNING = 3;

   function  crearTablaContactos(){
          
        let tabla = document.getElementById("tablaContactos");
        if(tabla) tabla.remove();

    google.script.run
    .withSuccessHandler(crearTablaContactosCorrectamente)
    .withFailureHandler(crearTablaContactosError)
    .obtenerContactos();
    
  }

   function crearTablaContactosCorrectamente(obj){
          
           tabla = document.createElement("table");
           tabla.id = 'tablaContactos';

           let tablaHeader = document.createElement("thead");
           let tablaBody = document.createElement("tbody");

            // SOLUCION UN BUCLE FOR

            // ESTE PRIMER BUCLE RECORRE LA CABECERA LA TABLA POR ES OBJ[0]
             
             let primeraFila = document.createElement('tr');

            for(let i = 0; i < obj[0].length; i++){
              
                    let celda = document.createElement('td');
                    celda.textContent = obj[0][i];
                    primeraFila.appendChild(celda);
 
            }

                    tablaHeader.appendChild(primeraFila);
                    tabla.appendChild(tablaHeader);

              // ESTE BUCLE RECORRE EL CUERPO DE LA TABLA POR OBJ[i][j], i es la fila y j la celda
            for(let i = 1; i< obj.length; i++){
              
                   let fila = document.createElement('tr');
                   for(let j = 0; j < obj[i].length; j++){
                      
                    let celda = document.createElement('td');
                    celda.textContent = obj[i][j];
                    fila.appendChild(celda);

                   }
                   
                    tablaBody.appendChild(fila);
                 
            }
             //AGREGAMOS CLASES DE BOOTSTRAP A LA CABECERA
        
             tablaHeader.classList.add('table-dark');

           // AGREGAMOS EL CUERPO A  LA TABLA
              tabla.appendChild(tablaBody);

            // AGREGAMOS ESTILOS DE BOOTSRAP A LA TABLA

              tabla.classList.add("table", "table-striped","border", "border-4" ,"border-dark");

              //  AGREGAMOS LA TABLA AL DIV CON ID divContactos
              document.getElementById("divContactos").appendChild(tabla);

              // MOSTRAR NOTIFICACION DE OK

              crearNotificacion(NOTIFICACION_OK, 'Contactos obtenidos correctamente', 'Todo en orden');

         }

         function crearTablaContactosError(){
            // MOSTRAR NOTIFICACION DE ERROR
               crearNotificacion(NOTIFICACION_DANGER, 'Los contactos no pueden obtenerse, error en cÃ³digo', 'Mensaje de error');

         }

         function crearNotificacion(tipo, mensaje, titulo){

            let mensajeNotificacion = document.getElementById('mensajeNotificacion');
            let tituloNotificacion = document.getElementById('tituloNotificacion');
            let elementoNotificacion = document.getElementById('notificacion');
            let iconoNotificacion = document.getElementById('iconoNotificacion');
            let notificacion = bootstrap.Toast.getOrCreateInstance(elementoNotificacion);

      // EDITAR NOTIFICACION
   
             mensajeNotificacion.textContent = mensaje;
             tituloNotificacion.textContent = titulo;

              switch(tipo){

                   case NOTIFICACION_OK:
                    iconoNotificacion.className = '';
                    iconoNotificacion.classList.add('bi','bi-check2-square');
                    elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-verde-oscuro');
                    break;
                  
                    case NOTIFICACION_DANGER:
                    iconoNotificacion.className = '';
                    iconoNotificacion.classList.add('bi','bi-bug');
                    elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-rojo-oscuro' );
                    break;

                    case NOTIFICACION_WARNING:
                    iconoNotificacion.className = '';
                    iconoNotificacion.classList.add('bi','bi-exclamation-square');
                    elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-amarillo-oscuro');
                    break;
              }

            
       // MOSTRAR LA NOTIFICACION

           notificacion.show();


         }
   
</script>